<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-SFTP File Browser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body data-theme="dark">

    <!-- Header -->
    <header class="main-header">
        <h1 class="header-title">Q-SFTP File Browser</h1>
        <div class="header-actions">
            {% if role == 'Administrator' %}
            <a href="/admin" class="btn-header" style="text-decoration: none; color: inherit;">üîê Admin Panel</a>
            {% endif %}
            <button class="btn-header">Transfer Manager</button>
            <span class="welcome-text">Welcome, {{ username }}</span>
            <button class="btn-logout" onclick="disconnectFromServer()">Logout</button>
            <div class="theme-toggles">
                <button class="theme-pill" onclick="setTheme('auto')">Auto</button>
                <button class="theme-pill" onclick="setTheme('light')">Light</button>
                <button class="theme-pill active" onclick="setTheme('dark')">Dark</button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb-bar">
        <span class="breadcrumb-link" id="current-path-display">Root</span>
    </div>

    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Action Cards Grid -->
        <div class="card-grid">
            <!-- Upload File Card -->
            <div class="action-card">
                <h3 class="card-title">Upload File</h3>
                <div class="upload-dropzone" id="upload-drop-zone"
                    onclick="document.getElementById('file-input').click()">
                    <p>Drop files here</p>
                    <small>or click to choose. Files will upload<br>with progress and can be canceled.</small>
                </div>
                <input type="file" id="file-input" multiple style="display:none;">
                <button class="btn-primary" onclick="document.getElementById('file-input').click()">Choose File</button>
            </div>

            <!-- Create Directory Card -->
            <div class="action-card">
                <h3 class="card-title">Create Directory</h3>
                <input type="text" id="new-dir-name" class="form-input" placeholder="New directory name">
                <button class="btn-primary" onclick="createDirectory()">Create</button>
            </div>

            <!-- Transfer Speed Settings Card -->
            <div class="action-card">
                <h3 class="card-title">Transfer Speed Settings</h3>
                <select id="speed-limit" class="form-select">
                    <option value="0">No Limit</option>
                    <option value="1024">1 MB/s</option>
                    <option value="5120">5 MB/s</option>
                    <option value="10240">10 MB/s</option>
                </select>
                <button class="btn-primary" onclick="setSpeedLimit()">Set Speed</button>
                <p class="speed-status">Current limit: <span id="current-speed">No Limit</span></p>
            </div>
        </div>

        <!-- Settings Row -->
        <div class="settings-row">
            <h3 class="settings-title">Settings</h3>
            <label class="setting-item">
                <span>File Integrity Verification</span>
                <input type="checkbox" id="integrity-check" checked>
            </label>
        </div>

        <!-- Data Table -->
        <div class="data-table-container">
            <div class="table-header-row">
                <h3 class="table-title" id="table-title">Contents of: /</h3>
                <div class="bulk-actions hidden" id="bulk-actions">
                    <span class="selected-count" id="selected-count">0 selected</span>
                    <button class="btn-bulk-download" onclick="downloadSelected()">
                        <i class="fa-solid fa-download"></i> Download
                    </button>
                    <button class="btn-bulk-delete" onclick="deleteSelected()">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </div>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this)">
                        </th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Modified</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="file-table-body">
                    <!-- JS populates this -->
                    <tr>
                        <td colspan="6" class="loading-cell"><i class="fa-solid fa-circle-notch fa-spin"></i> Loading...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Upload Progress (Top Floating) -->
    <div id="upload-progress-container" class="upload-progress-popup hidden">
        <div class="progress-info">
            <span id="upload-filename" class="font-mono">filename.ext</span>
            <small id="upload-file-counter" style="opacity: 0.7; margin-left: 8px;"></small>
            <div class="progress-track">
                <div id="upload-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <small id="upload-status" style="opacity: 0.7; margin-top: 4px; display: block;"></small>
        </div>
        <div class="upload-controls">
            <button id="btn-pause-upload" class="btn-pause">
                <i class="fa-solid fa-pause"></i> Pause
            </button>
            <button id="btn-resume-upload" class="btn-resume hidden">
                <i class="fa-solid fa-play"></i> Resume
            </button>
            <button id="btn-cancel-upload" class="btn-cancel">
                <i class="fa-solid fa-xmark"></i> Cancel
            </button>
        </div>
    </div>

    <!-- Upload Complete Toast (Bottom Right) -->
    <div id="upload-complete-toast" class="toast-notification hidden">
        <div class="toast-content">
            <h4>Upload complete</h4>
            <p id="toast-filename">filename.ext</p>
        </div>
        <button class="toast-close" onclick="closeToast()">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>

    <!-- Hash Verification Modal -->
    <div id="hash-verification-modal" class="hash-modal hidden">
        <div class="hash-modal-content">
            <div class="hash-modal-header">
                <h3 id="hash-modal-title">üîí File Integrity Verification</h3>
                <button class="hash-modal-close" onclick="closeHashModal()">√ó</button>
            </div>

            <div class="hash-modal-body">
                <!-- Verification Status -->
                <div id="hash-status-section" class="hash-status">
                    <div class="hash-status-icon" id="hash-status-icon">‚úì</div>
                    <div class="hash-status-text">
                        <h4 id="hash-status-title">Verified</h4>
                        <p id="hash-status-message">File integrity confirmed</p>
                    </div>
                </div>

                <!-- File Info -->
                <div class="hash-info-row">
                    <span class="hash-label">Filename:</span>
                    <span class="hash-value" id="hash-filename">-</span>
                </div>
                <div class="hash-info-row">
                    <span class="hash-label">File Size:</span>
                    <span class="hash-value" id="hash-filesize">-</span>
                </div>

                <!-- Hash Comparison -->
                <div class="hash-comparison">
                    <div class="hash-block">
                        <div class="hash-block-title">Original Hash (Upload)</div>
                        <div class="hash-block-value" id="hash-original">-</div>
                        <div class="hash-block-label">SHA-256</div>
                    </div>

                    <div class="hash-arrow">‚Üí</div>

                    <div class="hash-block">
                        <div class="hash-block-title">Current Hash (Download)</div>
                        <div class="hash-block-value" id="hash-current">-</div>
                        <div class="hash-block-label">SHA-256</div>
                    </div>
                </div>

                <!-- Match Indicator -->
                <div id="hash-match-indicator" class="hash-match">
                    <span id="hash-match-icon">‚úì</span>
                    <span id="hash-match-text">Hashes Match - File is Authentic</span>
                </div>
            </div>

            <div class="hash-modal-footer">
                <button class="btn-hash-close" onclick="closeHashModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>